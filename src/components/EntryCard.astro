---
import VideoEmbed from "./VideoEmbed.astro";
import MoodBoard from "./MoodBoard.astro";
import type { CollectionEntry } from "astro:content";
import { render } from "astro:content";

interface Props {
  entry: CollectionEntry<"entries">;
}

const { entry } = Astro.props;
const { data } = entry;
const { Content } = await render(entry);

const formattedDate = data.date.toLocaleDateString("en-US", {
  year: "numeric",
  month: "long",
  day: "numeric",
  timeZone: "UTC",
});

const videoUrls = data.videoUrl
  ? Array.isArray(data.videoUrl) ? data.videoUrl : [data.videoUrl]
  : [];
---

<article class="entry-card">
  <header>
    <time datetime={data.date.toISOString()}>{formattedDate}</time>
    <h2>{data.title}</h2>
  </header>

  {videoUrls.length > 0 && (
    <div class:list={["video-grid", { "single": videoUrls.length === 1 }]}>
      {videoUrls.map((url) => <VideoEmbed url={url} />)}
    </div>
  )}

  {data.moodboard && data.moodboard.length > 0 && (
    <MoodBoard items={data.moodboard} />
  )}

  <div class="entry-notes">
    <Content />
  </div>
</article>

<style>
  .entry-card {
    margin-bottom: 3rem;
    padding-bottom: 3rem;
    border-bottom: 1px solid #eee;
  }

  .entry-card:last-child {
    border-bottom: none;
  }

  header {
    margin-bottom: 1rem;
  }

  time {
    font-size: 0.85rem;
    color: #888;
    text-transform: uppercase;
    letter-spacing: 0.03em;
  }

  h2 {
    margin: 0.25rem 0 0;
    font-size: 1.5rem;
    font-weight: 600;
  }

  .video-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 0.75rem;
    margin: 1rem 0;
  }

  .video-grid :global(.video-embed) {
    margin: 0;
  }

  .entry-notes {
    margin-top: 1rem;
    line-height: 1.7;
    color: #333;
  }

  .entry-notes :global(p) {
    margin: 0.75rem 0;
  }

  .entry-notes :global(ul),
  .entry-notes :global(ol) {
    padding-left: 1.5rem;
  }

  .entry-notes :global(a) {
    color: #2563eb;
    text-decoration-thickness: 1px;
    text-underline-offset: 2px;
  }

  .entry-notes :global(code) {
    background: #f3f4f6;
    padding: 0.15em 0.35em;
    border-radius: 3px;
    font-size: 0.9em;
  }
</style>
